# Тестирование различных моделей

## Обзор

Документ описывает процесс тестирования различных архитектур нейронных сетей для задачи распознавания эмоций. Все эксперименты проводились с использованием скрипта [`src/queue_training.py`](src/queue_training.py).

Более подробные сведения можно получить, [изучив отчет о тестировании моделей](DeprecatedModels/total_report)

## Рассмотренные модели

В очереди обучения `TRAINING_QUEUE` были определены следующие конфигурации:

| # | Модель | Img Size | Batch | Epochs | LR | Unfreeze | Описание |
|---|-------|----------|-------|--------|-----|----------|----------|
| 1 | resnet18_baseline | 224 | 32 | 5 | 0.0003 | layer4 | Baseline ResNet18 с текущими гиперпараметрами |
| 2 | resnet18_fast | 128 | 64 | 3 | 0.001 | none | Быстрый ResNet18 с меньшим размером входа |
| 3 | mobilenet_v2_small | 128 | 64 | 5 | 0.0005 | layer4 | MobileNetV2 для эффективности |
| 4 | efficientnet_b0 | 128 | 32 | 5 | 0.0003 | layer4 | EfficientNet-B0 для лучшего соотношения точности и размера |
| 5 | resnet34_deep | 224 | 24 | 5 | 0.0002 | layer4 | Более глубокий ResNet34 для лучшей точности |

## Результаты обучения

Из файлов метаданных в [`DeprecatedModels/`](DeprecatedModels/):

### Сравнительная таблица

| Модель | Accuracy | F1-Score (macro) | Params (total) | Params (trainable) | Статус |
|--------|----------|------------------|-----------------|-------------------|--------|
| **resnet18_baseline** | **61.42%** | **56.94%** | 11,180,103 | 8,397,319 | Лучшая |
| resnet34_deep | 60.17% | 55.76% | 21,288,263 | 13,117,959 |  |
| mobilenet_v2_small | 41.85% | 35.96% | 2,232,839 | 8,967 |  |
| resnet18_fast | 34.63% | 31.91% | 11,180,103 | 3,591 |  |

> **Примечание:** Модель `efficientnet_b0` не была обучена (отсутствует в DeprecatedModels).

## Анализ результатов

### Почему resnet18_baseline лучшая:

1. **Наивысшая точность (61.42%)** - лучший результат среди всех протестированных моделей
2. **Наивысший F1-score (56.94%)** - сбалансированная производительность по всем классам
3. **Размер изображения 224x224** - сохраняет больше деталей для распознавания эмоций
4. **Частичное разморачивание (layer4)** - позволяет адаптировать глубокие признаки под задачу, сохраняя предобученные низкоуровневые признаки
5. **Хорошие ROC-AUC** - высокие значения по всем классам эмоций (особенно happy: 0.96, surprise: 0.96)

### Почему другие модели хуже:

- **resnet18_fast**: Полностью замороженный backbone (unfreeze: none) + маленький размер изображения = крайне низкая точность
- **mobilenet_v2_small**: Хотя модель легковесная, малый размер входа (128) и недостаточная глубина не позволили достичь хороших результатов
- **resnet34_deep**: Более глубокая архитектура, но не дала прироста точности по сравнению с resnet18, при этом имеет почти вдвое больше параметров

## Итоговая выбранная модель

### resnet18_baseline

**Конфигурация:**
- Архитектура: ResNet18 (pretrained на ImageNet)
- Размер входного изображения: 224x224
- Batch size: 32
- Epochs: 5
- Learning rate: 0.0003
- Weight decay: 0.01
- Стратегия разморачивания: layer4

**Метрики:**
- Accuracy: 61.42%
- F1-Score (macro): 56.94%
- Лучший тестовый accuracy: 61.42%

**ROC-AUC по классам:**
| Эмоция | AUC |
|--------|-----|
| angry | 0.867 |
| disgust | 0.956 |
| fear | 0.805 |
| happy | 0.962 |
| neutral | 0.876 |
| sad | 0.841 |
| surprise | 0.960 |

## Выводы

Модель `resnet18_baseline` была выбрана как итоговая благодаря оптимальному сочетанию:
- Высокой точности распознавания
- Сбалансированного F1-score
- Хорошей производительности на всех классах эмоций
- Разумного количества параметров (~11M)

